datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client"
}

model Tenant {
  id            String          @id @default(uuid())
  name          String
  code          String          @unique // Tenant code for subdomain or header
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  users         User[]
  apps          App[]
  hiddenDangers HiddenDanger[]  // 反向关系
}

model User {
  id            String          @id @default(uuid())
  email         String          @unique
  name          String?
  password      String          // Hashed
  roles         String          // JSON string for RBAC roles
  tenantId      String
  tenant        Tenant          @relation(fields: [tenantId], references: [id])
  hiddenDangers HiddenDanger[]  // 反向关系
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model App {
  id          String   @id @default(uuid())
  name        String
  description String?
  icon        String?
  status      String   @default("draft") // draft, published
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  createdBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 示例: 油田隐患单 (混合存储模式)
model HiddenDanger {
  id          String   @id @default(uuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  
  // 固定字段 (高频查询/索引字段)
  title       String
  level       String   // normal, critical
  status      String   @default("draft") // draft, pending, fixing, verifying, closed
  reporterId  String
  reporter    User     @relation(fields: [reporterId], references: [id])
  
  // JSON 字段 (扩展数据/低频字段)
  extraData   String   @default("{}") // SQLite 用 TEXT, PostgreSQL 用 JSONB
  // extraData 可存储: { description, location, images, gpsLatitude, gpsLongitude, discoveredAt, deadline }
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status, level])
  @@index([reporterId])
}
